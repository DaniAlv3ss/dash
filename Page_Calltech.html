<div id="calltech-loader" class="text-center py-20">
    <p class="text-lg font-semibold text-orange-500">Carregando dados de atendimento...</p>
</div>

<div id="calltech-content" style="visibility: hidden;">
    <div class="flex justify-end mb-6 relative">
        <div class="date-dropdown">
            <button id="ct-date-range-toggle" class="bg-white text-slate-700 border border-slate-300 px-4 py-2 rounded-md flex items-center gap-2">
                <span id="ct-date-range-display">Carregando...</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg>
            </button>
            <div id="ct-date-range-popup" class="date-popup">
                <div class="date-inputs">
                    <div><label for="ct-startDate">Data Início</label><input type="date" id="ct-startDate"></div>
                    <div><label for="ct-endDate">Data Fim</label><input type="date" id="ct-endDate"></div>
                </div>
                <div class="popup-actions">
                    <button id="ct-cancelButton" class="cancel-button">Cancelar</button>
                    <button id="ct-applyButton" class="apply-button">Aplicar</button>
                </div>
            </div>
        </div>
    </div>

    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="bg-white p-6 rounded-xl shadow-sm">
            <h4 class="text-slate-500 font-semibold">Total de Chamados</h4>
            <p id="kpi-total" class="text-4xl font-bold text-slate-800 mt-2">0</p>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm">
            <h4 class="text-slate-500 font-semibold">Chamados Abertos</h4>
            <p id="kpi-open" class="text-4xl font-bold text-yellow-500 mt-2">0</p>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm">
            <h4 class="text-slate-500 font-semibold">Chamados Finalizados</h4>
            <p id="kpi-closed" class="text-4xl font-bold text-green-500 mt-2">0</p>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm">
            <h4 class="text-slate-500 font-semibold">Tempo Médio de Resolução</h4>
            <p id="kpi-avg-time" class="text-4xl font-bold text-blue-500 mt-2">0 dias</p>
        </div>
    </section>

    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="bg-white p-6 rounded-xl shadow-sm">
            <h4 class="text-slate-500 font-semibold">Valor Retido no Atendimento</h4>
            <p id="kpi-retention-value" class="text-4xl font-bold text-slate-800 mt-2">R$ 0,00</p>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-sm flex flex-col md:col-span-2 lg:col-span-2">
            <h4 class="text-slate-500 font-semibold mb-2">Efetividade Pós-Atendimento</h4>
            <div class="flex flex-grow items-center gap-6">
                <div class="flex-shrink-0 text-center">
                    <p id="kpi-post-service-nps-score" class="text-5xl font-bold text-slate-800">0.0</p>
                    <p class="text-xs text-slate-400 mt-1">NPS Pós-Chamado</p>
                </div>
                <div class="flex-grow border-l border-slate-200 pl-6 space-y-2 text-sm">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <span class="h-2.5 w-2.5 rounded-full bg-emerald-500 mr-2"></span>Promotores
                        </div>
                        <strong id="kpi-post-service-promoters" class="font-bold text-slate-800">0</strong>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <span class="h-2.5 w-2.5 rounded-full bg-amber-500 mr-2"></span>Neutros
                        </div>
                        <strong id="kpi-post-service-neutrals" class="font-bold text-slate-800">0</strong>
                    </div>
                    <div class="flex justify-between items-center">
                       <div class="flex items-center">
                           <span class="h-2.5 w-2.5 rounded-full bg-red-500 mr-2"></span>Detratores
                       </div>
                        <strong id="kpi-post-service-detractors" class="font-bold text-slate-800">0</strong>
                    </div>
                    <div class="border-t border-slate-100 mt-2 pt-2 flex justify-between items-center">
                        <div class="text-slate-500 font-semibold">Base de Respostas</div>
                        <strong id="kpi-post-service-total" class="font-bold text-slate-800">0</strong>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm flex flex-col">
            <h4 class="text-slate-500 font-semibold mb-2">Chamados com NPS</h4>
            <div class="flex flex-grow items-center gap-6">
                <div class="flex-shrink-0">
                    <p id="kpi-nps-total" class="text-6xl font-bold text-slate-800">0</p>
                </div>
                <div class="flex-grow border-l border-slate-200 pl-6 space-y-2 text-sm">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center"><span class="h-2.5 w-2.5 rounded-full bg-emerald-500 mr-2"></span>Promotores</div>
                        <strong id="kpi-nps-promoters" class="font-bold text-slate-800">0</strong>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="flex items-center"><span class="h-2.5 w-2.5 rounded-full bg-amber-500 mr-2"></span>Neutros</div>
                        <strong id="kpi-nps-neutrals" class="font-bold text-slate-800">0</strong>
                    </div>
                    <div class="flex justify-between items-center">
                       <div class="flex items-center"><span class="h-2.5 w-2.5 rounded-full bg-red-500 mr-2"></span>Detratores</div>
                        <strong id="kpi-nps-detractors" class="font-bold text-slate-800">0</strong>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="text-lg font-semibold text-slate-800 mb-4">Efetividade da Equipe (Taxa de Resolução)</h3>
            <div id="resolution-rate-container" class="space-y-4">
                <div class="resolution-item">
                    <div class="flex justify-between items-center text-sm mb-1">
                        <span class="font-medium text-slate-600">Resolvido no mesmo dia (D+0)</span>
                        <span id="rate-day0-text" class="font-bold text-slate-800">0% (0)</span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2.5">
                        <div id="rate-day0-bar" class="bg-emerald-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                <div class="resolution-item">
                    <div class="flex justify-between items-center text-sm mb-1">
                        <span class="font-medium text-slate-600">Resolvido em 1 dia (D+1)</span>
                        <span id="rate-day1-text" class="font-bold text-slate-800">0% (0)</span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2.5">
                        <div id="rate-day1-bar" class="bg-sky-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                <div class="resolution-item">
                    <div class="flex justify-between items-center text-sm mb-1">
                        <span class="font-medium text-slate-600">Resolvido em 2 dias (D+2)</span>
                        <span id="rate-day2-text" class="font-bold text-slate-800">0% (0)</span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2.5">
                        <div id="rate-day2-bar" class="bg-amber-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                <div class="resolution-item">
                    <div class="flex justify-between items-center text-sm mb-1">
                        <span class="font-medium text-slate-600">Resolvido em 3 dias (D+3)</span>
                        <span id="rate-day3-text" class="font-bold text-slate-800">0% (0)</span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2.5">
                        <div id="rate-day3-bar" class="bg-orange-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                <div class="resolution-item">
                    <div class="flex justify-between items-center text-sm mb-1">
                        <span class="font-medium text-slate-600">Resolvido em 4 dias ou mais (D+4)</span>
                        <span id="rate-day4plus-text" class="font-bold text-slate-800">0% (0)</span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2.5">
                        <div id="rate-day4plus-bar" class="bg-red-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-lg font-semibold text-slate-800">Fluxo Diário de Chamados</h3>
                <div class="date-dropdown relative">
                    <button id="flow-date-range-toggle" class="bg-white text-slate-700 border border-slate-300 px-3 py-1 rounded-md flex items-center gap-2 text-sm">
                        <span id="flow-date-range-display">Últimos 7 dias</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg>
                    </button>
                    <div id="flow-date-range-popup" class="date-popup">
                        <div class="date-inputs">
                            <div><label for="flow-startDate">Data Início</label><input type="date" id="flow-startDate"></div>
                            <div><label for="flow-endDate">Data Fim</label><input type="date" id="flow-endDate"></div>
                        </div>
                        <div class="popup-actions">
                            <button id="flow-cancelButton" class="cancel-button">Cancelar</button>
                            <button id="flow-applyButton" class="apply-button">Aplicar</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="daily_flow_chart" style="width: 100%; height: 280px;">
                </div>
        </div>
    </section>

    <div class="bg-white p-6 rounded-xl shadow-sm">
        <div class="flex flex-col md:flex-row justify-between md:items-center mb-4 gap-4">
            <h3 class="text-lg font-semibold text-slate-800">Detalhes dos Chamados</h3>
            <div class="flex flex-wrap items-center gap-2">
                 <input type="text" id="filter-chamado-input" placeholder="Filtrar por Cód. Chamado..." class="border border-slate-300 rounded-md px-3 py-1.5 text-sm w-40">
                 <input type="text" id="filter-pedido-input" placeholder="Filtrar por Pedido..." class="border border-slate-300 rounded-md px-3 py-1.5 text-sm w-40">
                 
                 <div class="relative date-dropdown">
                    <button id="status-filter-toggle" class="bg-white text-slate-700 border border-slate-300 px-4 py-2 rounded-md flex items-center gap-2 text-sm h-full">
                        <span>Filtrar</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/></svg>
                    </button>
                    <div id="status-filter-popup" class="date-popup p-4" style="min-width: 250px;">
                        <h4 class="text-sm font-semibold text-slate-800 mb-3">Filtrar por Status</h4>
                        <div id="status-filter-options" class="space-y-2 max-h-60 overflow-y-auto pr-2">
                        </div>
                         <hr class="my-3">
                         <div class="space-y-2">
                            <div class="flex items-center">
                               <input type="checkbox" id="filter-nps-toggle" class="h-4 w-4 rounded border-slate-300 text-orange-600 focus:ring-orange-500">
                               <label for="filter-nps-toggle" class="ml-2 text-sm text-slate-600">Com NPS respondido</label>
                            </div>
                            <div class="flex items-center">
                               <input type="checkbox" id="filter-devolucao-toggle" class="h-4 w-4 rounded border-slate-300 text-orange-600 focus:ring-orange-500">
                               <label for="filter-devolucao-toggle" class="ml-2 text-sm text-slate-600">Com Devolução</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
                <thead class="bg-slate-50 text-slate-600 uppercase">
                    <tr>
                        <th class="p-3">Cód. Chamado</th>
                        <th class="p-3">Pedido</th>
                        <th class="p-3">Cliente</th>
                        <th class="p-3">Status</th>
                        <th class="p-3">Data Abertura</th>
                        <th class="p-3">Data Finalização</th>
                    </tr>
                </thead>
                <tbody id="calltech-table-body" class="text-slate-700">
                    </tbody>
            </table>
        </div>
        <div class="pagination-controls flex justify-end items-center mt-4 text-sm">
            <span id="ct-page-info"></span>
            <div class="ml-4">
                <button id="ct-prev-page" class="px-3 py-1 border border-slate-300 rounded-md hover:bg-slate-100 disabled:opacity-50">&lt;</button>
                <button id="ct-next-page" class="px-3 py-1 border border-slate-300 rounded-md hover:bg-slate-100 disabled:opacity-50 ml-2">&gt;</button>
            </div>
        </div>
    </div>
</div>

<div id="clientes-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[60] hidden items-center justify-center p-4 opacity-0 transition-opacity duration-300" onclick="closeClientesModal()">
    <div id="clientes-modal-content" class="bg-slate-100 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col transform scale-95 transition-transform duration-300" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center p-4 border-b bg-white rounded-t-xl">
            <h2 class="text-xl font-semibold text-slate-800">Histórico do Cliente</h2>
            <button id="close-clientes-modal-btn" class="text-slate-400 hover:text-slate-600 text-2xl font-bold">&times;</button>
        </div>
        <div class="p-6 overflow-y-auto">
            <div id="clientes-detail-loader" class="text-center py-10">
                <p class="text-slate-500">Carregando histórico...</p>
            </div>
            <div id="clientes-detail-content">
                </div>
        </div>
    </div>
</div>

<!-- MODAL PARA DETALHES DA DEVOLUÇÃO -->
<div id="devolucao-detail-modal" class="fixed inset-0 bg-black bg-opacity-60 z-[70] hidden items-center justify-center p-4 opacity-0 transition-opacity duration-300" onclick="closeDevolucaoDetailModal()">
    <div id="devolucao-detail-modal-content" class="bg-slate-100 rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col transform scale-95 transition-transform duration-300" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center p-4 border-b bg-white rounded-t-xl">
            <h2 id="devolucao-detail-title" class="text-xl font-semibold text-slate-800">Itens Devolvidos</h2>
            <button onclick="closeDevolucaoDetailModal()" class="text-slate-400 hover:text-slate-600 text-2xl font-bold">&times;</button>
        </div>
        <div class="p-6 overflow-y-auto">
            <div id="devolucao-detail-list" class="space-y-3">
                <!-- Itens serão injetados aqui via JS -->
            </div>
        </div>
    </div>
</div>
